SELECT 
    RD.RULE_ID, 
    RF.FLTR_ATTR_NM, 
    RF.FLTR_ATTR_TX, 
    COUNT(DISTINCT CASE WHEN RF.FLTR_CD = 'IN' THEN RF.FLTR_ATTR_NM END) AS IN_Filter_Count, 
    COUNT(DISTINCT CASE WHEN RF.FLTR_CD = 'NOT_IN' THEN RF.FLTR_ATTR_NM END) AS NOT_IN_Filter_Count
FROM RULE_DTL RD
INNER JOIN rule_fltr RF ON RD.RULE_ID = RF.RULE_ID
GROUP BY RD.RULE_ID, RF.FLTR_ATTR_NM, RF.FLTR_ATTR_TX
HAVING COUNT(DISTINCT CASE WHEN RF.FLTR_CD = 'IN' THEN RF.FLTR_ATTR_NM END) > 1
   AND COUNT(DISTINCT CASE WHEN RF.FLTR_CD = 'NOT_IN' THEN RF.FLTR_ATTR_NM END) > 1;
