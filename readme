SELECT 
    DCA.APPL_NM, 
    RD.CNSMR_INGESTION_ID, 
    RRL.*
FROM RULE_RUN_LOG RRL
INNER JOIN RULE_DTL RD ON RRL.RULE_ID = RD.RULE_ID
INNER JOIN DQAAS_CNSMR_APPL DCA ON RD.CNSMR_INGESTION_ID = DCA.CNSMR_INGESTION_ID
WHERE RRL.STS_CD = 'SUCCESS' 
  AND RRL.EXCP_CN = 0
  AND UPPER(RD.TYPE_CD) = 'COMPLETENESS' -- Rule Type in uppercase
  AND RD.SUB_TYPE_CD = 'NOT_NULL'
  AND (RD.CNSMR_INGESTION_ID, RRL.RULE_ID) IN (
    SELECT CNSMR_INGESTION_ID, RULE_ID
    FROM (
        SELECT 
            CNSMR_INGESTION_ID, 
            RULE_ID, 
            ROW_NUMBER() OVER(PARTITION BY CNSMR_INGESTION_ID ORDER BY RULE_ID) AS row_num
        FROM RULE_DTL
    )
    WHERE row_num <= 3
);
