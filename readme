from sqlalchemy import func

def get_latest_successful_runs(rule_ids):
    # Subquery to find the latest RUN_ID for each RULE_ID where STS_CD is 'SUCCESS'
    latest_run_subquery = session.query(
        RuleRunLog.RULE_ID,
        func.max(RuleRunLog.RUN_ID).label('latest_run_id')
    ).filter(
        RuleRunLog.STS_CD == 'SUCCESS'
    ).group_by(
        RuleRunLog.RULE_ID
    ).subquery()

    # Main query to get the rows that match the RULE_IDs and have the latest RUN_ID
    latest_successful_runs = session.query(RuleRunLog)\
        .join(
            latest_run_subquery, 
            (RuleRunLog.RULE_ID == latest_run_subquery.c.RULE_ID) &
            (RuleRunLog.RUN_ID == latest_run_subquery.c.latest_run_id)
        ).filter(
            RuleRunLog.RULE_ID.in_(rule_ids)
        ).all()

    return latest_successful_runs
