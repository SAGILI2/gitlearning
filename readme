from sqlalchemy.orm import aliased

@staticmethod
def get_profiling_results(profile_id):
    max_run_id = execute_raw_oracle(MAX_RUN_ID.format(profile_id=profile_id))
    if max_run_id := max_run_id.first()[0]:
        
        subquery = (
            db.session.query(ProfileCategoricalColStatModel)
            .filter(ProfileCategoricalColStatModel.profile_id == profile_id)
            .limit(10)
            .subquery()
        )
        
        alias = aliased(ProfileCategoricalColStatModel, subquery)

        results = (
            ProfileRsltsMastModel.query
            .join(alias, ProfileRsltsMastModel.profile_id == alias.profile_id)
            .filter(
                ProfileRsltsMastModel.profile_id == profile_id,
                ProfileRsltsMastModel.run_id == max_run_id
            )
            .all()
        )
        
        return results
    else:
        return None
